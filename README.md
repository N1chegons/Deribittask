# Client for Derbit

## üöÄ –¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ

- –ö–ª–∏–µ–Ω—Ç –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ API –¥–ª—è Deribit(https://docs.deribit.com/)

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¢–ó:

1. **–ö–ª–∏–µ–Ω—Ç –¥–ª—è Deribit API**
   - –ü–æ–ª—É—á–µ–Ω–∏–µ index price –¥–ª—è BTC/USD –∏ ETH/USD –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å UNIX timestamp

2. **FastAPI Backend**
   - 3 GET endpoints —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `ticker`
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ –≤–∞–ª—é—Ç–µ
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ü–µ–Ω—ã
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–µ (—Ñ–æ—Ä–º–∞—Ç YYYY-MM-DD)

3. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
   - PostgreSQL —Å SQLAlchemy ORM
   - –ú–æ–¥–µ–ª—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ü–µ–Ω –≤–∞–ª—é—Ç

4. **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏**
   - Celery –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á
   - Redis –∫–∞–∫ –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

[![Python](https://img.shields.io/badge/Python-3.11-blue?logo=python&logoColor=white)](https://www.python.org)
[![FastAPI](https://img.shields.io/badge/FastAPI-005571?logo=fastapi)](https://fastapi.tiangolo.com)
[![SQLAlchemy](https://img.shields.io/badge/SQLAlchemy-D71F00?logo=sqlalchemy&logoColor=white)](https://www.sqlalchemy.org)
[![Celery](https://img.shields.io/badge/Celery-37814A?logo=celery&logoColor=white)](https://docs.celeryq.dev)
[![Redis](https://img.shields.io/badge/Redis-DC382D?logo=redis&logoColor=white)](https://redis.io)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-4169E1?logo=postgresql&logoColor=white)](https://www.postgresql.org)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
deribit-api/
‚îú‚îÄ‚îÄ src/
‚îÇ ‚îú‚îÄ‚îÄ currency/ # –ú–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–∞–ª—é—Ç–∞–º–∏
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ celery_config.py # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Celery
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ models.py # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ schemas.py # Pydantic —Å—Ö–µ–º—ã
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ router.py # –û—Å–Ω–æ–≤–Ω–æ–π —Ä–æ—É—Ç–µ—Ä
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ service.py # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î
‚îÇ ‚îú‚îÄ‚îÄ main.py # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI
‚îÇ ‚îú‚îÄ‚îÄ config.py # –ö–ª–∞—Å—Å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îÇ ‚îú‚îÄ‚îÄ logger.py # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (logger)
‚îÇ ‚îú‚îÄ‚îÄ utilits.py # –ó–∞–¥–∞—á–∞ celery
‚îÇ ‚îî‚îÄ‚îÄ database.py # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î
‚îú‚îÄ‚îÄ alembic/ # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îÇ ‚îú‚îÄ‚îÄ env.py # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
‚îÇ ‚îî‚îÄ‚îÄ script.py.mako ‚Ññ 
‚îú‚îÄ‚îÄ tests/ # Unit —Ç–µ—Å—Ç—ã
‚îÇ ‚îú‚îÄ‚îÄ unit/
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ test_api.py # –§–∞–π–ª —Å —Ç–µ—Å—Ç–∞–º–∏
‚îú‚îÄ‚îÄ .env.example # –®–∞–±–ª–æ–Ω –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ poetry.lock # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Poetry
‚îú‚îÄ‚îÄ pyproject.toml # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Poetry
‚îî‚îÄ‚îÄ README.md # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
#### 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –∑–∞—Ç–µ–º –≤–æ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
```bash
git clone https://github.com/N1chegons/Deribittask.git
cd Deribittask
```

#### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ Poetry
```bash
poetry install
```

#### 3. –°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π .env –∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∏—Å—Ö–æ–¥—è –∏–∑ –≤–∞—à–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ [.env.example](.env.example). –°–æ—Å—Ç–∞–≤–ª—è—é—â–µ–µ —Ñ–∞–π–ª–∞:
```
DB_HOST=localhost
DB_PORT=5432
DB_NAME=my_db
DB_USER=user
DB_PASS=pass

REDIS_URL=redis://localhost:6379/0 < –ú–æ–∂–µ—Ç–µ –æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —Ç.–∫. –∑–∞–ø—É—Å–∫ –±—É–¥–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ Docker —Å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –ø–æ—Ä—Ç–æ–º
```

#### 4. –ü—Ä–æ–≤–µ–¥–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
```bash
alembic revision --autogenerate -m "First Initial"
alembic upgrade head
```

#### 5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Redis —á–µ—Ä–µ–∑ Docker. –ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å Docker Dekstop
```bash
docker run -d -p 6379:6379 --name redis-celery redis:alpine     
```

#### 6. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ worker celery
```bash
celery -A src.currency.celery_config.celery_app worker --loglevel=info --pool=gevent
```

#### 7. –¢–∞–∫–∂–µ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç–µ beat celery
```bash
celery -A src.currency.celery_config.celery_app beat --loglevel=info
```

#### 8. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä uvicorn
```bash
uvicorn src.main:app --reload # —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–∞–ø—É—Å–∫
uvicorn src.main:app --reload --port 1000 # –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç 
```



## üì° API Endpoints
 - –í—Å–µ –º–µ—Ç–æ–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç GET –∑–∞–ø—Ä–æ—Å—ã —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º ticker.

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ –≤–∞–ª—é—Ç–µ
```
GET http://127.0.0.1:8000/ticker/data/?ticker=BTCUSD
```
#### Response:
```
[
  {
    "id": 1,
    "ticker": "BTCUSD",
    "price": 87662.53,
    "timestamp": 1769534255,
    "created_at": "2026-01-27T17:17:36.085877"
  },
  {
    "id": 3,
    "ticker": "BTCUSD",
    "price": 87559.44,
    "timestamp": 1769534311,
    "created_at": "2026-01-27T17:18:31.480640"
  }
]
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ü–µ–Ω—ã
```
GET http://127.0.0.1:8000/ticker/latest_price/?ticker=BTCUSD
```
#### Response:
```
{
  "–ü–æ—Å–ª–µ–¥–Ω—è—è —Ü–µ–Ω–∞ BTCUSD": 87632.2
}
```

### 3.  –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω—ã —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ –¥–∞—Ç–µ
```
GET http://127.0.0.1:8000/ticker/prices/filtered/?ticker=ETHUSD&date_from=2026-01-27&date_to=2026-01-27
```
#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- date_from (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD
- date_to (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD
- 
#### Response:
```
{
  "–¢–∏–∫–µ—Ä: ": "ETHUSD",
  "–ü–µ—Ä–∏–æ–¥ —Å: ": "2026-01-27",
  "–ü–µ—Ä–∏–æ–¥ –ø–æ: ": "2026-01-27",
  "–¶–µ–Ω–∞: ": [
    2945.21,
    2942.42,
    2939.98
  ]
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
pytest -s -v
```

## üìù Design Decisions
#### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ 
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ —Å–ª–æ–∏:
- models.py - SQLAlchemy –º–æ–¥–µ–ª–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- schemas.py - Pydantic —Å—Ö–µ–º—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- service.py - –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- utilits.py - Celery –∑–∞–¥–∞—á–∏ –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

#### 2. –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å
- FastAPI –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ API
- Request –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Deribit
- Celery —Å gevent –ø—É–ª–æ–º –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
- –ò—Å–ø–æ–ª—å–∑—É—é gevent —Ç.–∫. Celery –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Windows
- –ò—Å–ø–æ–ª—å–∑—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –ø–æ—Ç–æ–º—É —á—Ç–æ: –ü—Ä–æ–µ–∫—Ç –Ω–µ –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π, –ø–µ—Ä–≤—ã–π –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã —Å Celery.

####  3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- PostgreSQL –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–∞—è —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –ë–î
- SQLAlchemy —Å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –¥—Ä–∞–π–≤–µ—Ä–æ–º psycopg2
- Alembic –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

#### 4. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏
- Celery Beat –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á
- Redis –∫–∞–∫ –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π
- –ò–∑–æ–ª—è—Ü–∏—è –∑–∞–¥–∞—á –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–µ–Ω –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ API

#### 5. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ò—Å–ø–æ–ª—å–∑—É—é logger –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è API

## üë§ –ê–≤—Ç–æ—Ä
- –ë–æ–≥–¥–∞–Ω
- GitHub: N1chegons
- Telegram: @Nichegons
- Email: nichegons@gmail.com
